parameters:

- name: name
  displayName: Job Name
  type: string
  default: Rotate_Cosmos_Db_Keys

- name: displayName
  displayName: Job Display Name
  type: string
  default: Rotate Cosmos DB Keys

- name: dependsOn
  displayName: Depends On
  type: object
  default: ''

- name: condition
  displayName: Condition
  type: string
  default: ''

- name: variables
  displayName: Variables
  type: object
  default: ''

- name: vmImage
  displayName: Variables
  type: string
  default: ubuntu-latest

- name: serviceConnectionName
  displayName: Service Connection Name
  type: string

- name: artefactName
  displayName: Artefact Name
  type: string
  default: Deployment Scripts

- name: scriptArguments
  displayName: Script Arguments
  type: string

- name: scriptPath
  displayName: Script Path
  type: string

- name: taskName
  displayName: Task Name
  type: string
  default: Run_PowerShell_Script

- name: taskDisplayName
  displayName: Task Display Name
  type: string
  default: Run PowerShell Script

jobs:
- job: ${{ parameters.name }}
  displayName: ${{ parameters.displayName }}
  ${{ if not(eq(parameters.dependsOn, '')) }}:
    dependsOn: ${{ parameters.dependsOn }}
  ${{ if not(eq(parameters.condition, '')) }}:
    condition: ${{ parameters.condition }}
  ${{ if not(eq(parameters.variables, '')) }}:
    variables: ${{ parameters.variables }}
  pool:
    vmImage: ${{ parameters.vmImage }}
  steps:
  - download: current
    artifact: ${{ parameters.artefactName }}
  - task: AzurePowerShell@5
    name: ${{ parameters.taskName }}
    displayName: ${{ parameters.taskDisplayName }}
    inputs:
      azureSubscription: ${{ parameters.serviceConnectionName }}
      scriptType: FilePath
      scriptPath: ${{ parameters.scriptPath }}
      scriptArguments: ${{ parameters.scriptArguments }}
      failOnStandardError: true
      azurePowerShellVersion: LatestVersion
      pwsh: true
